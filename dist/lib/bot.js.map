{"version":3,"sources":["../../lib/bot.js"],"names":["mongoose","require","moment","module","exports","PageInfoSchema","Schema","page_id","type","String","required","title","picture","owner","Types","ObjectId","ref","bot_id","StatusSchema","read_only","Boolean","default","status","enum","page","page_info","payments_status","BotSchema","date_added","Number","valueOf","timezone","offset","name","default_block","starting_block","help_block","menu_block","ai_block","blocks","description","admins","default_group_id","groups","is_valid","history","Object","timestamps","createdAt","updatedAt","collection","index","Model","model","e"],"mappings":"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","file":"bot.js","sourcesContent":["'use strict'\nvar mongoose = require('mongoose')\nlet moment = require('moment')()\n\nmodule.exports = function () {\n\n  let PageInfoSchema = new mongoose.Schema({\n    page_id: {type: String, required: true},\n    title: {type: String, required: true},\n    picture: {type: String},\n    owner: {type: mongoose.Schema.Types.ObjectId, ref: 'user', required: false},\n    bot_id: {type: String}\n  })\n\n  let StatusSchema = new mongoose.Schema({\n    read_only: {type: Boolean, required: true, default: false},\n    status: {\n      type: String, required: true, enum: ['draft', 'connected', 'disabled'], default: 'draft'\n    },\n    page: {type: String},\n    page_info: {type: PageInfoSchema},\n    payments_status: {type: String}\n  })\n\n  let BotSchema = new mongoose.Schema({\n    title: {type: String, required: true},\n    // date_added: {type: Number, default: , required: true},\n    date_added: {type: Number, required: true, default: moment.valueOf()},\n    timezone: {offset: {type: Number}, name: {type: String}},\n    default_block: {type: mongoose.Schema.Types.ObjectId, ref: 'block', required: false},\n    starting_block: {type: mongoose.Schema.Types.ObjectId, ref: 'block', required: false},\n    help_block: {type: mongoose.Schema.Types.ObjectId, ref: 'block', required: false},\n    menu_block: {type: mongoose.Schema.Types.ObjectId, ref: 'block', required: false},\n    ai_block: {type: mongoose.Schema.Types.ObjectId, ref: 'block', required: false},\n    blocks: [{type: mongoose.Schema.Types.ObjectId, ref: 'block', required: false}],\n    description: {type: String, require: true},\n    status: {type: StatusSchema, required: false},\n    admins: [{type: mongoose.Schema.Types.ObjectId, ref: 'user', required: false}],\n    default_group_id: {type: mongoose.Schema.Types.ObjectId, ref: 'group', required: false},\n    groups: [{type: mongoose.Schema.Types.ObjectId, ref: 'group', required: false}],\n    is_valid: {type: Boolean, required: true, default: false},\n    history: [Object]\n  }, {timestamps: {createdAt: 'created_at', updatedAt: 'updated_at'}}, {collection: 'bot'})\n\n  BotSchema.index({title: 1, description: 1})\n  BotSchema.index({admins: 1})\n\n  let Model\n  try {\n    // Throws an error if \"Name\" hasn't been registered\n    Model = mongoose.model('bot')\n  } catch (e) {\n    Model = mongoose.model('bot', BotSchema)\n  }\n  return Model\n}\n"]}